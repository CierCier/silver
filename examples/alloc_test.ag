import std.io;

struct Point {
    i32 x;
    i32 y;
}

impl Point {
    void print(Point* self) {
        printf("Point(%d, %d)\n", self->x, self->y);
    }
}

i32 main() {
    printf("=== Testing alloc<T>() - single allocation ===\n");
    
    // Allocate a single i32 on the heap
    i32* num = alloc<i32>();
    *num = 42;
    printf("Allocated i32: %d\n", *num);
    free(num);
    
    printf("\n=== Testing alloc<T>() - struct allocation ===\n");
    
    // Allocate a Point on the heap
    Point* p = alloc<Point>();
    p->x = 10;
    p->y = 20;
    printf("Allocated Point: ");
    p->print();
    free(p);
    
    printf("\n=== Testing alloc<T>(count) - array allocation ===\n");
    
    // Allocate an array of 5 Points
    Point* points = alloc<Point>(5);
    
    // Initialize the array
    for (i32 i = 0; i < 5; i = i + 1) {
        points[i].x = i * 10;
        points[i].y = i * 20;
    }
    
    // Print the array
    printf("Allocated array of 5 Points:\n");
    for (i32 i = 0; i < 5; i = i + 1) {
        printf("  [%d] ", i);
        Point* pt = &points[i];
        pt->print();
    }
    
    // Free the array
    free(points);
    
    printf("\n=== Testing alloc<T>(count) - primitive array ===\n");
    
    // Allocate an array of integers
    i32* numbers = alloc<i32>(10);
    
    // Initialize
    for (i32 i = 0; i < 10; i = i + 1) {
        numbers[i] = i * i;
    }
    
    // Print squares
    printf("Squares: ");
    for (i32 i = 0; i < 10; i = i + 1) {
        printf("%d ", numbers[i]);
    }
    printf("\n");
    
    free(numbers);
    
    printf("\nDone!\n");
    return 0;
}
